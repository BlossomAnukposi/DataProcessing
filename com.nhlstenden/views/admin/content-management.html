<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Content Management - Netflix Admin</title>
    <link rel="stylesheet" href="../../stylesheet/admin.css" />
    <link rel="stylesheet" href="../../stylesheet/content-management.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="admin-container">
      <!-- Sidebar Navigation -->
      <nav class="admin-sidebar">
        <div class="logo">
          <img
            src="../../images/logo/logo_short.png"
            alt="Netflix Logo"
            width="50"
          />
        </div>
        <ul class="nav-links">
          <li>
            <a href="dashboard.html"><i class="fas fa-home"></i> Dashboard</a>
          </li>
          <li>
            <a href="content-management.html" class="active"
              ><i class="fas fa-film"></i> Content Management</a
            >
          </li>
          <li>
            <a href="users.html"><i class="fas fa-users"></i> Users</a>
          </li>
          <li>
            <a href="genres.html"><i class="fas fa-tags"></i> Genres</a>
          </li>
          <li>
            <a href="subscriptions.html"
              ><i class="fas fa-credit-card"></i> Subscriptions</a
            >
          </li>
          <li>
            <a href="analytics.html"
              ><i class="fas fa-chart-bar"></i> Analytics</a
            >
          </li>
        </ul>
      </nav>

      <!-- Main Content Area -->
      <main class="main-content">
        <header class="admin-header">
          <h1>Content Management</h1>
          <button class="add-content-btn">
            <i class="fas fa-plus"></i> Add New Content
          </button>
        </header>

        <!-- Search and Filter Section -->
        <div class="search-filter-section">
          <div class="search-box">
            <input type="text" placeholder="Search content..." />
            <i class="fas fa-search"></i>
          </div>
          <div class="filters">
            <select>
              <option value="">Content Type</option>
              <option value="movie">Movie</option>
              <option value="series">TV Series</option>
            </select>
            <select>
              <option value="">Genre</option>
              <option value="action">Action</option>
              <option value="comedy">Comedy</option>
              <option value="drama">Drama</option>
            </select>
            <select>
              <option value="">Status</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
              <option value="upcoming">Upcoming</option>
            </select>
          </div>
        </div>

        <!-- Content List -->
        <div class="content-list">
          <!-- Content Item -->
          <div class="content-item">
            <img
              src="../../images/movie/lost_in_space.png"
              alt="Lost in Space"
            />
            <div class="content-details">
              <h3>Lost in Space</h3>
              <p class="type">TV Series • 3 Seasons</p>
              <p class="genre">Sci-Fi, Adventure</p>
            </div>
            <div class="content-status active">Active</div>
            <div class="content-actions">
              <button class="edit-btn"><i class="fas fa-edit"></i></button>
              <button class="delete-btn"><i class="fas fa-trash"></i></button>
            </div>
          </div>

          <div class="content-item">
            <img src="../../images/movie/skyscraper.png" alt="Skyscraper" />
            <div class="content-details">
              <h3>Skyscraper</h3>
              <p class="type">Movie • 2h 15m</p>
              <p class="genre">Action, Thriller</p>
            </div>
            <div class="content-status active">Active</div>
            <div class="content-actions">
              <button class="edit-btn"><i class="fas fa-edit"></i></button>
              <button class="delete-btn"><i class="fas fa-trash"></i></button>
            </div>
          </div>

          <div class="content-item">
            <img
              src="../../images/movie/kung_fu_panda.png"
              alt="Kung Fu Panda"
            />
            <div class="content-details">
              <h3>Kung Fu Panda</h3>
              <p class="type">Movie • 1h 32m</p>
              <p class="genre">Animation, Action</p>
            </div>
            <div class="content-status upcoming">Upcoming</div>
            <div class="content-actions">
              <button class="edit-btn"><i class="fas fa-edit"></i></button>
              <button class="delete-btn"><i class="fas fa-trash"></i></button>
            </div>
          </div>
        </div>

        <!-- Pagination -->
        <div class="pagination">
          <button class="prev-btn"><i class="fas fa-chevron-left"></i></button>
          <div class="page-numbers">
            <button class="active">1</button>
            <button>2</button>
            <button>3</button>
            <span>...</span>
            <button>10</button>
          </div>
          <button class="next-btn"><i class="fas fa-chevron-right"></i></button>
        </div>
      </main>
    </div>

    <!-- Add Content Modal -->
    <div id="addContentModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Add New Content</h2>
        <form id="addContentForm">
          <!-- Basic Information -->
          <div class="form-group">
            <label for="title">Title *</label>
            <input type="text" id="title" name="title" required />
          </div>

          <div class="form-group">
            <label for="contentType">Content Type *</label>
            <select id="contentType" name="contentType" required>
              <option value="">Select Type</option>
              <option value="movie">Movie</option>
              <option value="series">TV Series</option>
            </select>
          </div>

          <!-- Duration/Seasons (will toggle based on content type) -->
          <div class="form-group movie-field">
            <label for="duration">Duration (minutes) *</label>
            <input type="number" id="duration" name="duration" min="1" />
          </div>

          <div class="form-group series-field" style="display: none">
            <label for="seasons">Number of Seasons *</label>
            <input type="number" id="seasons" name="seasons" min="1" />
          </div>

          <!-- Genre Selection -->
          <div class="form-group">
            <label for="genres">Genres *</label>
            <select id="genres" name="genres" multiple required>
              <option value="action">Action</option>
              <option value="comedy">Comedy</option>
              <option value="drama">Drama</option>
              <option value="horror">Horror</option>
              <option value="scifi">Sci-Fi</option>
              <option value="thriller">Thriller</option>
              <option value="animation">Animation</option>
              <option value="documentary">Documentary</option>
            </select>
            <small>Hold Ctrl/Cmd to select multiple genres</small>
          </div>

          <!-- Release Information -->
          <div class="form-group">
            <label for="releaseDate">Release Date *</label>
            <input type="date" id="releaseDate" name="releaseDate" required />
          </div>

          <div class="form-group">
            <label for="status">Status *</label>
            <select id="status" name="status" required>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
              <option value="upcoming">Upcoming</option>
            </select>
          </div>

          <!-- Media -->
          <div class="form-group">
            <label for="thumbnail">Thumbnail Image *</label>
            <input
              type="file"
              id="thumbnail"
              name="thumbnail"
              accept="image/*"
              required
            />
          </div>

          <!-- Description -->
          <div class="form-group">
            <label for="description">Description *</label>
            <textarea
              id="description"
              name="description"
              rows="4"
              required
            ></textarea>
          </div>

          <!-- Additional Information -->
          <div class="form-group">
            <label for="cast">Cast (comma-separated)</label>
            <input
              type="text"
              id="cast"
              name="cast"
              placeholder="Actor 1, Actor 2, Actor 3"
            />
          </div>

          <div class="form-group">
            <label for="director">Director</label>
            <input type="text" id="director" name="director" />
          </div>

          <div class="form-group">
            <label for="rating">Rating</label>
            <select id="rating" name="rating">
              <option value="">Select Rating</option>
              <option value="G">G</option>
              <option value="PG">PG</option>
              <option value="PG-13">PG-13</option>
              <option value="R">R</option>
              <option value="NC-17">NC-17</option>
            </select>
          </div>

          <button type="submit" class="submit-btn">Add Content</button>
        </form>
      </div>
    </div>

    <script>
      // Get modal elements
      const modal = document.getElementById("addContentModal");
      const addBtn = document.querySelector(".add-content-btn");
      const closeBtn = document.querySelector(".close");
      const form = document.getElementById("addContentForm");

      // Open modal
      addBtn.onclick = function () {
        modal.style.display = "block";
      };

      // Close modal
      closeBtn.onclick = function () {
        modal.style.display = "none";
      };

      // Close modal when clicking outside
      window.onclick = function (event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      };

      // Handle form submission
      form.onsubmit = function (e) {
        e.preventDefault();
        // Add your form submission logic here
        console.log("Form submitted");
        modal.style.display = "none";
      };

      // Add this after your existing modal scripts
      const contentTypeSelect = document.getElementById("contentType");
      const movieField = document.querySelector(".movie-field");
      const seriesField = document.querySelector(".series-field");

      contentTypeSelect.addEventListener("change", function () {
        if (this.value === "movie") {
          movieField.style.display = "block";
          seriesField.style.display = "none";
          document.getElementById("duration").required = true;
          document.getElementById("seasons").required = false;
        } else if (this.value === "series") {
          movieField.style.display = "none";
          seriesField.style.display = "block";
          document.getElementById("duration").required = false;
          document.getElementById("seasons").required = true;
        } else {
          movieField.style.display = "none";
          seriesField.style.display = "none";
          document.getElementById("duration").required = false;
          document.getElementById("seasons").required = false;
        }
      });

      // Add event listeners to all edit and delete buttons
      document.querySelectorAll('.edit-btn').forEach(button => {
          button.addEventListener('click', function(e) {
              const contentItem = this.closest('.content-item');
              const title = contentItem.querySelector('h3').textContent;
              const type = contentItem.querySelector('.type').textContent;
              const genre = contentItem.querySelector('.genre').textContent;
              const status = contentItem.querySelector('.content-status').textContent;
              
              // Open the modal and change title
              modal.style.display = "block";
              modal.querySelector('h2').textContent = "Edit Content"; // Change modal title
              isEditing = true;
              editingElement = contentItem;
              
              // Pre-fill the form with existing content data
              document.getElementById('title').value = title;
              
              // Set content type
              if (type.includes('Movie')) {
                  contentTypeSelect.value = 'movie';
                  movieField.style.display = 'block';
                  seriesField.style.display = 'none';
                  // Extract duration from type (e.g., "Movie • 2h 15m")
                  const duration = type.match(/(\d+)h\s*(\d+)m/);
                  if (duration) {
                      const hours = parseInt(duration[1]);
                      const minutes = parseInt(duration[2]);
                      document.getElementById('duration').value = hours * 60 + minutes;
                  }
              } else if (type.includes('Series')) {
                  contentTypeSelect.value = 'series';
                  movieField.style.display = 'none';
                  seriesField.style.display = 'block';
                  // Extract seasons from type (e.g., "TV Series • 3 Seasons")
                  const seasons = type.match(/(\d+)\s*Seasons/);
                  if (seasons) {
                      document.getElementById('seasons').value = seasons[1];
                  }
              }
              
              // Set genres
              const genres = genre.split(', ');
              Array.from(document.getElementById('genres').options).forEach(option => {
                  option.selected = genres.includes(option.text);
              });
              
              // Set status
              document.getElementById('status').value = status.toLowerCase();
          });
      });

      document.querySelectorAll('.delete-btn').forEach(button => {
          button.addEventListener('click', function(e) {
              const contentItem = this.closest('.content-item');
              const title = contentItem.querySelector('h3').textContent;
              
              if (confirm(`Are you sure you want to delete "${title}"?`)) {
                  // Add animation for smooth removal
                  contentItem.style.animation = 'fadeOut 0.3s ease';
                  setTimeout(() => {
                      contentItem.remove();
                  }, 300);
                  
                  // Here you would typically make an API call to delete the content
                  console.log(`Deleted content: ${title}`);
              }
          });
      });

      // Add this CSS for the fade out animation
      const style = document.createElement('style');
      style.textContent = `
          @keyframes fadeOut {
              from { opacity: 1; }
              to { opacity: 0; }
          }
      `;
      document.head.appendChild(style);

      // Modify the form submission handler to handle both add and edit cases
      let isEditing = false;
      let editingElement = null;

      form.onsubmit = function (e) {
          e.preventDefault();
          
          const formData = new FormData(form);
          const contentData = {
              title: formData.get('title'),
              type: formData.get('contentType'),
              duration: formData.get('duration'),
              seasons: formData.get('seasons'),
              genres: Array.from(document.getElementById('genres').selectedOptions).map(opt => opt.text).join(', '),
              status: formData.get('status')
          };

          if (isEditing && editingElement) {
              // Update existing content
              updateContentItem(editingElement, contentData);
              isEditing = false;
              editingElement = null;
          } else {
              // Create new content item
              createNewContentItem(contentData);
          }

          // Reset form and close modal
          form.reset();
          modal.style.display = "none";
      };

      function createNewContentItem(data) {
          const newItem = document.createElement('div');
          newItem.className = 'content-item';
          newItem.innerHTML = `
              <img src="../../images/movie/placeholder.png" alt="${data.title}">
              <div class="content-details">
                  <h3>${data.title}</h3>
                  <p class="type">${data.type === 'movie' ? 
                      `Movie • ${Math.floor(data.duration/60)}h ${data.duration%60}m` : 
                      `TV Series • ${data.seasons} Seasons`}</p>
                  <p class="genre">${data.genres}</p>
              </div>
              <div class="content-status ${data.status}">${data.status}</div>
              <div class="content-actions">
                  <button class="edit-btn"><i class="fas fa-edit"></i></button>
                  <button class="delete-btn"><i class="fas fa-trash"></i></button>
              </div>
          `;
          
          // Add event listeners to new buttons
          newItem.querySelector('.edit-btn').addEventListener('click', editButtonHandler);
          newItem.querySelector('.delete-btn').addEventListener('click', deleteButtonHandler);
          
          document.querySelector('.content-list').appendChild(newItem);
      }

      function updateContentItem(element, data) {
          element.querySelector('h3').textContent = data.title;
          element.querySelector('.type').textContent = data.type === 'movie' ? 
              `Movie • ${Math.floor(data.duration/60)}h ${data.duration%60}m` : 
              `TV Series • ${data.seasons} Seasons`;
          element.querySelector('.genre').textContent = data.genres;
          element.querySelector('.content-status').textContent = data.status;
          element.querySelector('.content-status').className = `content-status ${data.status}`;
      }

      // Clear form when adding new content
      addBtn.addEventListener('click', function() {
          isEditing = false;
          editingElement = null;
          form.reset();
          modal.querySelector('h2').textContent = "Add New Content"; // Reset modal title
      });
    </script>
  </body>
</html>
